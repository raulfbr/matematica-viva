{% macro scene_card(title, icon='', id='') %}
<div class="scene-card" {% if id %}id="{{ id }}"{% endif %}>
    {% if title %}
    <div class="scene-header">
        {% if icon %}<span class="scene-icon">{{ icon }}</span>{% endif %}
        {{ title }}
    </div>
    {% endif %}
    {{ caller() }}
</div>
{% endmacro %}

{% macro instruction_box(icon='ğŸ’¡', content='') %}
<div class="instruction-box">
    <span class="instruction-icon">{{ icon }}</span>
    <div>
        {{ content | safe }}
        {{ caller() if caller else '' }}
    </div>
</div>
{% endmacro %}

{% macro script_persona(name, avatar, text, tone='', is_portador=False) %}
<div class="script-persona-block {{ 'portador-block' if is_portador else '' }}">
    <img src="../assets/cards/guardioes/{{ avatar }}" class="script-avatar" alt="{{ name }}">
    <div class="script-content">
        <div class="script-header">
            <span class="script-name">{{ name }}</span>
            {% if tone %}
                {# LÃ³gica de Toms AutomÃ¡ticos (SSOT) #}
                {% if toms and toms.tons and toms.tons[tone] %}
                    <span class="script-tone tone-tooltip" data-tooltip="{{ toms.tons[tone].desc }}">
                        <span style="font-style: normal;">{{ toms.tons[tone].icone }}</span> ({{ tone }})
                    </span>
                {% else %}
                    {# Fallback para texto livre #}
                    <span class="script-tone">({{ tone }})</span>
                {% endif %}
            {% endif %}
        </div>
        <div class="script-text">
            {{ text | replace('\n', '<br>') | safe }}
        </div>
    </div>
</div>
{% endmacro %}

{% macro nav_button(url, direction, label, title) %}
<a href="{{ url }}" class="nav-btn {{ direction }}">
    <span class="nav-label">{{ 'â†' if direction == 'prev' else '' }} {{ label }} {{ 'â†’' if direction == 'next' else '' }}</span>
    <span class="nav-title">{{ title }}</span>
</a>
{% endmacro %}

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOVOS MACROS - MigraÃ§Ã£o 16/01/2026
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}

{# MACRO: Portador da Tocha (usa emoji, nÃ£o imagem) #}
{% macro portador_block(tom, texto) %}
<div class="script-persona-block portador-block">
    <span class="portador-icon">ğŸ”¥</span>
    <div class="script-content">
        <div class="script-header">
            <span class="script-name">Portador da Tocha</span>
            {% if tom %}
                {# LÃ³gica de Toms AutomÃ¡ticos (SSOT) #}
                {% if toms and toms.tons and toms.tons[tom] %}
                    <span class="script-tone tone-tooltip" data-tooltip="{{ toms.tons[tom].desc }}">
                        <span style="font-style: normal;">{{ toms.tons[tom].icone }}</span> ({{ tom }})
                    </span>
                {% else %}
                    {# Fallback para texto livre #}
                    <span class="script-tone">({{ tom }})</span>
                {% endif %}
            {% endif %}
        </div>
        <div class="script-text">
            {{ texto | replace('\n', '<br>') | safe }}
        </div>
    </div>
</div>
{% endmacro %}

{# MACRO: Local Card (visualizaÃ§Ã£o do local) #}
{% macro local_card(nome, imagem) %}
<div class="local-card">
    <p><strong>ğŸ“ Local:</strong> {{ nome }}</p>
    <p class="local-label">Visualizar</p>
    <img src="../assets/cards/locais/{{ imagem }}" alt="{{ nome }}">
</div>
{% endmacro %}

{# MACRO: Box por Autor (Para a FamÃ­lia) #}
{% macro author_box(tipo, titulo, conteudo) %}
<div class="{{ tipo }}-box">
    <strong>{{ titulo }}</strong><br>
    {{ conteudo | safe }}
</div>
{% endmacro %}

